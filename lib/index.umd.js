(function(n,v){typeof exports=="object"&&typeof module<"u"?module.exports=v(require("vue")):typeof define=="function"&&define.amd?define(["vue"],v):(n=typeof globalThis<"u"?globalThis:n||self,n.imageCoord=v(n.Vue))})(this,function(n){"use strict";const v=(x,f)=>{const C=x.__vccOpts||x;for(const[_,i]of f)C[_]=i;return C},S={class:"wrap"},V=["src"],W=[v({__name:"imageCoord",props:{config:{type:Object,default:()=>({imgUrl:"",originX:0,originY:0,width:0,height:0,x:0,y:0,showBoundary:!0,showAxis:!0})}},setup(x,{expose:f}){const C=x,_=n.reactive({originX:[{type:"number",min:0,max:100,message:"原点X轴位置必须在0%到100%之间",trigger:"blur"}],originY:[{type:"number",min:0,max:100,message:"原点Y轴位置必须在0%到100%之间",trigger:"blur"}],x:[{type:"number",trigger:"blur"}],y:[{type:"number",trigger:"blur"}]}),{config:i}=n.toRefs(C),m=n.ref(null),E=n.ref(null);let k={},y={x:0,y:0};const b={width:30,height:30,color:"red"};n.onMounted(()=>{});const T=()=>{M(),z(m.value,k),O(m.value)},I=()=>{const t=i.value,e=[];for(const o in _){const r=_[o],a=parseFloat(t[o]);for(const c of r)if(a<c.min||a>c.max){e.push(c.message);break}}if(e.length>0)throw console.error("参数校验失败：",e),new Error(e);return!0},M=()=>{U(),y=L(i.value.x,i.value.y)},L=(t,e)=>N(t,e,k,E.value,i.value.width,i.value.height),N=(t,e,o,r,a,c)=>{const{left:d,right:h,top:u,bottom:s}=o,p=h-d,l=s-u,g=t/(a/2)*(p/2),w=e/c*l,B=i.value.originX/100,A=i.value.originY/100,R=(d+h)*B+g,X=(u+s)*A+w,H=r.getBoundingClientRect(),F=H.width/r.naturalWidth,G=H.height/r.naturalHeight;return{x:R*F,y:X*G}},P=()=>{if(I()){j(),y=L(i.value.x,i.value.y);const e=m.value,o=document.createElement("div");o.className="moving-dot",o.style.position="absolute",o.style.borderRadius="50%",o.style.width=`${b.width}px`,o.style.height=`${b.height}px`,o.style.backgroundColor=b.color,o.style.pointerEvents="none",o.style.zIndex=10,o.style.boxShadow="0 0 5px rgba(0, 0, 0, 0.4)",o.style.left=`${y.x-b.width/2}px`,o.style.top=`${y.y-b.height/2}px`,e.appendChild(o)}},j=()=>{const t=m.value,e=t.querySelector(".moving-dot");e&&t.removeChild(e)},$=t=>{const e=document.createElement("div");return e.className="showBoundary-line",Object.assign(e.style,{position:"absolute",backgroundColor:"red",zIndex:80,pointerEvents:"none",...t}),i.value.showBoundary===!1&&(e.style.opacity=0),e},q=t=>{const e=document.createElement("div");return e.className="showAxis-line",Object.assign(e.style,{position:"absolute",backgroundColor:"Green",zIndex:80,pointerEvents:"none",...t}),i.value.showAxis===!1&&(e.style.opacity=0),e},z=(t,e)=>{t.querySelectorAll(".showBoundary-line").forEach(w=>{w&&w.remove()});const{left:o,right:r,top:a,bottom:c}=e,d=t.querySelector("img").getBoundingClientRect(),h=d.width/t.querySelector("img").naturalWidth,u=d.height/t.querySelector("img").naturalHeight,s=o*h,p=r*h,l=a*u,g=c*u;t.appendChild($({left:`${s}px`,top:`${l}px`,width:"4px",height:`${g-l}px`})),t.appendChild($({left:`${p}px`,top:`${l}px`,width:"4px",height:`${g-l}px`})),t.appendChild($({left:`${s}px`,top:`${l}px`,width:`${p-s}px`,height:"4px"})),t.appendChild($({left:`${s}px`,top:`${g}px`,width:`${p-s}px`,height:"4px"}))},O=t=>{t.querySelectorAll(".showAxis-line").forEach(e=>{e&&e.remove()}),t.appendChild(q({left:"0px",top:`${y.y}px`,width:"100%",height:"2px"})),t.appendChild(q({left:`${y.x}px`,top:"0px",width:"2px",height:"100%"}))},U=()=>{k=D(m.value,E.value)},D=(t,e)=>{if(!t||!e)return null;const o=t.getBoundingClientRect(),r=e.getBoundingClientRect(),a=e.naturalWidth,c=e.naturalHeight,d=r.width,h=r.height,u=o.width,s=o.height,p=a/d,l=c/h,g=(u-d)/2,w=(s-h)/2,B=Math.round(g*p),A=Math.round(u*p-B),R=Math.round(w*l),X=Math.round(s*l-R);return{left:B,right:A,top:R,bottom:X}};return f({drawDot:P}),(t,e)=>(n.openBlock(),n.createElementBlock("div",S,[n.createElementVNode("div",{class:"container",ref_key:"imgContainer",ref:m},[n.createElementVNode("img",{class:"wrap-img",ref_key:"imgRef",ref:E,src:n.unref(i).imgUrl,onLoad:T},null,40,V)],512)]))}},[["__scopeId","data-v-b2b3e6e3"]])],Y=function(x){W.forEach(f=>{x.component(f.name,f)})};return typeof window<"u"&&window.Vue&&Y(window.Vue),{install:Y}});
